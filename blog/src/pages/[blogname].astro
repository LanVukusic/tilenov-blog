---
import Content from "../components/content.astro";
import Outline from "../layouts/Outline.astro";
import { useSanityClient, groq } from "astro-sanity";
import type { Post } from "../dto";

export interface Props {}
const { blogname } = Astro.params;

export function getStaticPaths() {
  return [
    { params: { blogname: "opis-stanja" } },
    { params: { blogname: "filozofska-zgoda" } },
    { params: { blogname: "studentska-balada" } },
    { params: { blogname: "prostori-protestantov" } },
    { params: { blogname: "kratk-premislek" } },
  ];
}

export async function getFirstBlogPost(url?: string) {
  if (!url) return [];
  const query = groq`*[_type == "blogpost" && url == "${url}"]`;
  const firstPost = await useSanityClient().fetch(query);
  return firstPost;
}

const post: Post = (await getFirstBlogPost(blogname))[0];
---

<Outline title="Tilenov blog">
  {
    post && (
      <Content
        title={post.naslov}
        content={post.content}
        updatedAt={post._updatedAt}
      />
    )
  }
</Outline>
